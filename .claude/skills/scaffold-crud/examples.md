# Usage Examples

Real-world examples of using `/scaffold-crud` for Phase 2 entities.

## Example 1: Task Entity (Chunk 2)

### Basic Task with All Features

```bash
/scaffold-crud entity=Task fields="title:str:required,description:str:optional,status:str:enum=pending|in_progress|completed:default=pending,priority:str:enum=high|medium|low,tags:list[str]:default=[],due_date:datetime:optional,completed:bool:default=false" relationships="belongs_to:User:user_id"
```

**Generates:**
- Task table with 9 columns + user_id + timestamps
- API endpoints: GET /tasks, POST /tasks, PATCH /tasks/:id, DELETE /tasks/:id
- Query params: ?status=pending&priority=high&search=...
- React components: TaskList, TaskCard, TaskForm
- Events: TASK_CREATED, TASK_UPDATED, TASK_COMPLETED, TASK_DELETED

**Database Schema:**
```sql
CREATE TABLE tasks (
    id UUID PRIMARY KEY,
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    title TEXT NOT NULL,
    description TEXT,
    status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'in_progress', 'completed')),
    priority TEXT CHECK (priority IN ('high', 'medium', 'low')),
    tags TEXT[],
    due_date TIMESTAMPTZ,
    completed BOOLEAN DEFAULT false,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## Example 2: Habit Entity (Chunk 3)

### Habit with Atomic Habits Fields

```bash
/scaffold-crud entity=Habit fields="identity_statement:str:required,full_description:str:optional,two_minute_version:str:required,habit_stacking_cue:str:optional,motivation:str:optional,category:str:enum=Health|Productivity|Relationships|Personal Growth|Mindfulness|Learning|Finance|Creative|Other,recurring_schedule:jsonb:optional,current_streak:int:default=0,last_completed_at:datetime:optional,consecutive_misses:int:default=0" relationships="belongs_to:User:user_id"
```

**Generates:**
- Habit table with Atomic Habits columns
- API endpoints with category filtering
- React components styled for habits
- Events: HABIT_CREATED, HABIT_UPDATED, HABIT_DELETED

**Usage After Generation:**
```typescript
// Frontend usage
const { data: habits } = useQuery({
  queryKey: ['habits', userId, 'Health'],
  queryFn: () => fetchHabits(userId, { category: 'Health' })
});
```

---

## Example 3: HabitCompletion Entity (Chunk 4)

### Completion Tracking with Relationships

```bash
/scaffold-crud entity=HabitCompletion fields="habit_id:uuid:required:foreign_key=habits.id,completion_type:str:enum=full|two_minute:required,completed_at:datetime:required" relationships="belongs_to:Habit:habit_id,belongs_to:User:user_id"
```

**Generates:**
- HabitCompletion table with foreign keys
- API endpoint: POST /habits/:id/complete
- Unique constraint: One completion per habit per day
- Events: HABIT_COMPLETED

**After Generation, Add Business Logic:**
```python
# apps/api/src/routes/habit_completion.py
@router.post("/habits/{habit_id}/complete")
async def complete_habit(
    user_id: UUID,
    habit_id: UUID,
    completion_data: HabitCompletionCreate,
    session: Session = Depends(get_session)
):
    # Check for duplicate completion today
    today = datetime.utcnow().date()
    existing = session.exec(
        select(HabitCompletion)
        .where(HabitCompletion.habit_id == habit_id)
        .where(func.date(HabitCompletion.completed_at) == today)
    ).first()

    if existing:
        raise HTTPException(409, "Already completed today")

    # Create completion (scaffolded code handles this)
    completion = HabitCompletion(...)

    # Update habit streak (custom logic)
    habit = session.get(Habit, habit_id)
    if habit.last_completed_at == today - timedelta(days=1):
        habit.current_streak += 1
    else:
        habit.current_streak = 1

    habit.last_completed_at = datetime.utcnow()
    habit.consecutive_misses = 0

    session.add(completion)
    session.add(habit)
    session.commit()

    await emit_habit_completed(user_id, habit, completion)
    return completion
```

---

## Example 4: Generated Task from Habit (Chunk 5)

### Task with Habit Reference

When scaffolding Task entity for Chunk 5, add habit relationship:

```bash
/scaffold-crud entity=Task fields="title:str:required,description:str:optional,status:str:enum=pending|in_progress|completed:default=pending,priority:str:optional,tags:list[str]:default=[],due_date:datetime:optional,completed:bool:default=false,generated_by_habit_id:uuid:optional:foreign_key=habits.id,is_habit_task:bool:default=false" relationships="belongs_to:User:user_id,belongs_to:Habit:generated_by_habit_id"
```

**Adds to Task:**
- `generated_by_habit_id` - Links task to originating habit
- `is_habit_task` - Flags habit-generated tasks

**Query habit-generated tasks:**
```python
# Get all tasks generated by a specific habit
habit_tasks = session.exec(
    select(Task)
    .where(Task.generated_by_habit_id == habit_id)
    .where(Task.user_id == user_id)
).all()
```

---

## Example 5: Minimal Entity (Skip Frontend)

### Backend-Only Entity

For entities that don't need UI (e.g., audit logs):

```bash
/scaffold-crud entity=AuditLog fields="user_id:uuid:required:foreign_key=users.id,action:str:required,entity_type:str:required,entity_id:uuid:required,changes:jsonb:optional,ip_address:str:optional" skip_frontend=true
```

**Generates:**
- Backend API only (no React components)
- Useful for internal entities

---

## Example 6: Customization After Scaffolding

### Adding Custom Endpoints

After scaffolding Task entity, add custom endpoint:

```bash
# 1. Scaffold basic CRUD
/scaffold-crud entity=Task fields="..."

# 2. Add custom endpoint for marking complete
/add-api-endpoint method=PATCH path="/api/{user_id}/tasks/{task_id}/complete" response="TaskResponse"
```

**Or manually add to generated `apps/api/src/routes/task.py`:**
```python
@router.patch("/{task_id}/complete", response_model=TaskResponse)
async def mark_task_complete(
    user_id: UUID,
    task_id: UUID,
    session: Session = Depends(get_session)
):
    """Mark task as completed (custom endpoint)."""
    task = session.get(Task, task_id)
    if not task or task.user_id != user_id:
        raise HTTPException(404, "Task not found")

    task.status = "completed"
    task.completed = True
    task.updated_at = datetime.utcnow()

    session.add(task)
    session.commit()
    session.refresh(task)

    await emit_task_completed(user_id, task)
    return task
```

---

## Example 7: Complex Filtering

### Task List with Multiple Filters

After scaffolding, enhance list endpoint:

```python
# Generated by scaffold-crud:
@router.get("/", response_model=List[TaskResponse])
async def list_tasks(
    user_id: UUID,
    session: Session = Depends(get_session)
):
    tasks = session.exec(select(Task).where(Task.user_id == user_id)).all()
    return tasks

# Enhance with custom filters:
@router.get("/", response_model=List[TaskResponse])
async def list_tasks(
    user_id: UUID,
    session: Session = Depends(get_session),
    status: Optional[str] = None,
    priority: Optional[str] = None,
    tag: Optional[str] = None,
    search: Optional[str] = None,
    sort: str = "created_desc"
):
    """List tasks with advanced filtering."""
    query = select(Task).where(Task.user_id == user_id)

    # Status filter
    if status:
        query = query.where(Task.status == status)

    # Priority filter
    if priority:
        query = query.where(Task.priority == priority)

    # Tag filter
    if tag:
        query = query.where(Task.tags.contains([tag]))

    # Search (title or description)
    if search:
        search_term = f"%{search}%"
        query = query.where(
            or_(
                Task.title.ilike(search_term),
                Task.description.ilike(search_term)
            )
        )

    # Sorting
    if sort == "due_date_asc":
        query = query.order_by(Task.due_date.asc())
    elif sort == "due_date_desc":
        query = query.order_by(Task.due_date.desc())
    elif sort == "priority_asc":
        query = query.order_by(Task.priority.asc())
    else:  # created_desc (default)
        query = query.order_by(Task.created_at.desc())

    tasks = session.exec(query).all()
    return tasks
```

---

## Example 8: Frontend Component Styling (Chunk 6)

### Applying Cozy Notebook Design

After scaffolding generates basic components, apply design system:

```typescript
// Generated: apps/web/src/components/task-card.tsx
export function TaskCard({ task }: TaskCardProps) {
  return (
    <div className="bg-white p-4 rounded shadow">
      <h3>{task.title}</h3>
      <p>{task.description}</p>
    </div>
  );
}

// Enhanced with Chunk 6 design:
export function TaskCard({ task }: TaskCardProps) {
  return (
    <div className="bg-paper-white p-6 rounded-lg shadow-paper hover:shadow-paper-lift transition-all border-2 border-ink-medium border-dashed relative">
      {/* Folded corner effect */}
      <div className="absolute top-0 right-0 w-8 h-8 bg-paper-shadow transform rotate-45 translate-x-4 -translate-y-4" />

      {/* Title with handwritten font */}
      <h3 className="font-handwritten text-xl text-ink-dark mb-2">
        {task.title}
      </h3>

      {/* Description with print font */}
      <p className="font-print text-sm text-ink-medium leading-relaxed">
        {task.description}
      </p>

      {/* Priority badge */}
      {task.priority && (
        <span className={`
          inline-block px-3 py-1 mt-3 rounded-full text-sm font-handwritten
          ${task.priority === 'high' ? 'bg-highlight-pink text-ink-red' : ''}
          ${task.priority === 'medium' ? 'bg-highlight-yellow text-ink-dark' : ''}
          ${task.priority === 'low' ? 'bg-highlight-mint text-ink-green' : ''}
        `}>
          {task.priority}
        </span>
      )}

      {/* Hand-drawn checkbox */}
      <button
        onClick={() => handleComplete(task.id)}
        className="mt-4 w-10 h-10 border-3 border-ink-medium rounded-md hover:bg-highlight-mint transition-colors"
      >
        {task.completed && (
          <CheckIcon className="text-ink-green animate-draw-checkmark" />
        )}
      </button>
    </div>
  );
}
```

---

## Workflow Summary

**For each entity:**

1. **Scaffold base structure:**
   ```bash
   /scaffold-crud entity=EntityName fields="..."
   ```

2. **Review generated files:**
   - Check database schema
   - Verify API endpoints
   - Test with `/docs`

3. **Run migration:**
   ```bash
   alembic upgrade head
   ```

4. **Customize business logic:**
   - Add validation
   - Enhance queries
   - Add custom endpoints

5. **Style components (Chunk 6):**
   - Apply design tokens
   - Add animations
   - Test on mobile

6. **Test thoroughly:**
   - Unit tests
   - API tests
   - E2E tests
